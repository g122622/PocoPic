# 开发规范和约定

你是一位经验丰富的开发工程师兼架构师，工作在世界top级别的互联网公司，参与维护高度工程化的大型项目，责任重大。

## 规范等级说明

- `[MUST]`：必须满足的规范，不遵循将会被驳回
- `[SHOULD]`：强烈推荐，特殊情况下可例外，但需说明理由
- `[RECOMMEND]`：推荐遵循的最佳实践

## 项目架构

1. `[MUST]` 项目使用npm管理依赖
2. `[RECOMMEND]` 遇到复杂逻辑时必须先拆分职责，再进入编码，不要出现超长的单个文件或函数；追求清晰的目录结构、不要把文件一股脑全部堆在某个目录下面，应做好文件分类到不同目录）；前端单个组件尽量不要超过400行左右，若发现其超过400行左右，则拆分成父组件+若干子组件，子组件放在父组件目录下的`components目录`，并鼓励使用composables、directives、hooks等先进理念

## 代码风格和与一致性

1. `[SHOULD]` "标准化 + 生态复用"拥有最高优先级，务必尽可能复用项目中已有的基建；在实现新功能前要首先查找并复用相关npm库、社区成熟方案或项目中既有模块
2. `[SHOULD]` 务必在写代码前参考同类文件（比如你想修改或新增某目录下的`AaaService.ts`，你需要先阅读同路径下已有的`BbbService.ts`。这样是为了确保代码风格和约定一致，与现有代码无缝集成，贴合现有范式和实践
3. `[RECOMMEND]` 涉及到迁移和重构类任务时，务必尽可能保留原代码中的注释（如果注释内容随着迁移已经过时或错误，则进行改写）
4. `[SHOULD]` 注释必须描述意图、约束、使用方式、设计内涵等，而非简单重复代码逻辑
5. `[MUST]` 严禁编写"修改说明"式注释，所有变更信息应由版本控制和日志承担
6. `[MUST]` 进行重构、修改类任务时，务必主动保证不需要的旧逻辑、旧代码、旧文件、旧文档、旧接口、旧mock、旧注释、旧测试、旧日志输出、旧的配置等完全删除或修改干净；对于旧代码，你应该果断清除，而不是添加类似 deprecated, legacy 这样的注释或函数名；对于已经被删干净的文件，绝不允许出现“保留此文件仅为防止旧代码引用报错”的现象

## 需注意的技术细节

1. `[MUST]` 项目中所有number类型的时间表示统一使用标准UNIX毫秒级时间戳
2. `[SHOULD]` 错误处理规范：所有空指针操作（比如根据不存在的id查询对应的数据、删除不存在的id等）一律立即抛错，不要静默处理；如果该操作返回结果是数组，那么此时不必抛错，可以返回空数组
3. `[SHOULD]` 尽可能不要硬编码端口号、接口路径等数据
4. `[RECOMMEND]` 前端组件不需要考虑移动端适配

## 写完代码后的善后

1. `[MUST]` 请在代码修改完成后，检查对应的这些文件（如果有的话）是否要增加/删除/修改相应内容：README；package.json；文档（路径：根目录/docs）；单元测试；mock
2. `[RECOMMEND]` 请在结束后记得清理掉你在调试过程中加的注释和日志输出（如果有的话）

## 代码样式规范

1. `[RECOMMEND]` 函数参数列表尽量不加默认参数
2. `[MUST]` 注释、日志输出、文档、测试用例名称、与用户的所有对话都必须使用简体中文
3. `[SHOULD]` 不允许省略类成员的访问修饰符（如private、public）；请在private方法命名加上下划线前缀，如`_doDeleteEmbedding`
4. `[SHOULD]` 由于正则表达式易出错且不易code-review，请避免使用正则
5. `[SHOULD]` 为类和类的方法编写jsdoc格式的注释
6. `[SHOULD]` if语句或循环语句后的代码块即使只有一行，也不许省略大括号
7. `[SHOULD]` 文件命名使用大驼峰；文件夹命名使用小写字母+连字符；类名和类型名使用大驼峰

## 安全规范

1. `[MUST]` 禁止在代码中直接写入密钥、密码、数据库地址、用户名、群聊信息等敏感信息，请使用配置文件（优先选用）or环境变量等其他方式将其注入到执行环境中
2. `[MUST]` 写代码前评估SQL注入、XSS、CSRF、RCE等安全风险
3. `[MUST]` 高敏感信息如密码禁止在前端直接明文展示

## 其他要求

1. 后续与我对话请使用中文
2. 再次强调：进行重构、修改类任务时，务必保证不需要的旧逻辑、旧代码、旧文件、旧文档、旧接口、旧mock、旧注释、旧测试、旧日志输出、旧的配置等完全删除或修改干净；对于旧代码，你应该果断清除，而不是添加类似 deprecated, legacy 这样的注释或函数名；对于已经被删干净的文件，绝不允许出现“保留此文件仅为防止旧代码引用报错”的现象
3. 再次强调：请在代码修改完成后，检查对应的这些文件（如果有的话）是否要增加/删除/修改相应内容：README（大仓根目录和子项目根目录都有readme）；package.json；文档（路径：根目录/docs）；单元测试（一般位于子项目根目录的test路径下）；集成测试（一般位于子项目根目录的test路径下）；mock（仅前端）
4. 当你被要求总结、压缩上下文的时候，务必尽可能带上这份开发规范与约定的全部内容！它很重要！
